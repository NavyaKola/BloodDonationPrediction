library(randomForest)
library(caret)
library(e1071)
library(ROSE)

train.data <- read.csv("TrainData.csv")
test.data <- read.csv("TestData.csv")


head(train.data)
head(test.data)

plot(train.data)
train.data$Made.Donation.in.March.2007 <- as.factor(train.data$Made.Donation.in.March.2007)

str(train.data)

summary(train.data)

#Dividing the training data into train and test subsets

ind <-sample(2,nrow(train.data),replace = TRUE, prob =c(0.8,0.2))
tdata <- train.data[ind==1,]
testData <- train.data[ind==2,]
nrow(tdata)
nrow(testData)

#Checking the correlation between dependent and independent variable

cor(tdata$Made.Donation.in.March.2007,tdata$Total.Volume.Donated..c.c..)

#Applying Logistic Model


model1 <- glm(Made.Donation.in.March.2007 ~ Months.since.Last.Donation +
              Number.of.Donations + Total.Volume.Donated..c.c.. + 
              Months.since.First.Donation , data = tdata)
summary(model1)

model2 <- glm(Made.Donation.in.March.2007 ~ Months.since.Last.Donation +
                Number.of.Donations + 
                Months.since.First.Donation , data = tdata)
summary(model2)

#prediction 
p1 <- predict(model2,testData)
head(p1)
#write.csv(p1,file = "value",col.names = F,row.names = F)

#Miscalculation error - train data
var1 <- ifelse(p1 > 0.35, 1 ,0)
tab1 <- table(predicted = var1 , actual = testData$Made.Donation.in.March.2007)
tab1
confusionMatrix(tab1)

error_cal <- 1 - sum(diag(tab1))/sum(tab1)
error_cal


#Miscalcualtion error - test data
p2 <- predict(model2,test.data)
var2 <- ifelse(p2>0.5 , 1, 0)
head(var2)

logistic_data <- cbind(test.data,p2)
write.csv(logistic_data,file = "LogisticsData.csv")

#Goodness of fit test:
with(model2 ,pchisq(null.deviance - deviance,df.null-df.residual,lower.tail = F))